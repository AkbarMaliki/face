{"version":3,"sources":["webpack:///./src/pages/index.vue?d3e0","webpack:///src/pages/index.vue","webpack:///./src/pages/index.vue?2c98","webpack:///./src/pages/index.vue","webpack:///./src/pages/index.vue?c6a6"],"names":["port","intervals","render","_vm","this","_h","$createElement","_c","_self","staticClass","staticStyle","_v","_s","dbTime","substring","attrs","on","saveDatabase","cache","toFixed","ref","style","width","progressPercent","staticRenderFns","data","img","recognition","loading","dbFace","value","max","methods","test","getCache","setInterval","that","caches","keys","then","open","cacheNames","forEach","match","request","response","blob","loadDatabase","console","log","$forceUpdate","wajah","cnv","toDataURL","postMessage","JSON","stringify","computed","watch","newValue","$nextTick","mounted","loadModel","component"],"mappings":"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","file":"js/page-index~ba2602be.c262b449.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticClass:\"p-3\"},[_c('div',{staticClass:\"p-2 shadow  rounded shadow\",staticStyle:{\"background\":\"#15388B\",\"color\":\"white\",\"padding\":\"20px\",\"box-shadow\":\"1px 1px 2px 1px grey\",\"border-radius\":\"10px\"}},[(_vm.recognition)?_c('div',[_c('p',{staticClass:\"p-2 font-semibold text-lg animate__animated animate__bounce animate__infinite\"},[_vm._v(\"Recognition ...\")])]):_c('div',[(_vm.dbFace)?_c('div',{staticClass:\"m-0 p-0\"},[_vm._v(\"DB \"),_c('span',{staticStyle:{\"font-weight\":\"bold\"}},[_vm._v(\"Ready \")]),_vm._v(\" (\"+_vm._s(_vm.dbTime.substring(0,15))+\") \"),_c('button',{staticClass:\"btn btn-sm btn-style10 ml-5\",staticStyle:{\"background\":\"#008E43\",\"padding-left\":\"20px\",\"padding-right\":\"20px\",\"margin-left\":\"20px\",\"border-radius\":\"10px\",\"border\":\"1.5px solid grey\",\"padding\":\"3px\",\"position\":\"absolute\",\"right\":\"10px\",\"color\":\"white\"},attrs:{\"type\":\"button\"},on:{\"click\":_vm.saveDatabase}},[_vm._v(\"Update DB\")]),_c('br'),_vm._v(\"Cache : \"+_vm._s((_vm.cache/1000).toFixed(2))+\" KB \"),_c('div',{staticClass:\"loading-bar-container\"},[_c('div',{ref:\"loadingBar\",staticClass:\"loading-bar\",style:({ width: _vm.progressPercent })})])]):_c('div',[_vm._v(\"Loading Getting Database ... \")]),_c('p',{staticClass:\"text-lg m-0 p-0\"},[_vm._v(\"Face Recognition : \"),(_vm.loading)?_c('span',[_vm._v(\"Loading ...\")]):_c('span',{staticClass:\"font-semibold\"},[_vm._v(\"Ready\")])])])])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div>\r\n    <div class=\"p-3\">\r\n      <div  class=\"p-2 shadow  rounded shadow\" style=\"background:#15388B;color:white;padding:20px;box-shadow:1px 1px 2px 1px grey;border-radius:10px;\">\r\n        <div v-if=\"recognition\">\r\n          <p class=\"p-2 font-semibold text-lg animate__animated animate__bounce animate__infinite\">Recognition ...</p>\r\n        </div>\r\n        <div v-else> \r\n          <div class=\"m-0 p-0\" v-if=\"dbFace\">DB <span  style=\"font-weight:bold;\">Ready </span> ({{dbTime.substring(0,15)}}) <button type=\"button\" @click=\"saveDatabase\" class=\"btn btn-sm btn-style10 ml-5\"  style=\"background:#008E43;padding-left:20px;padding-right:20px;margin-left:20px;border-radius:10px;border:1.5px solid grey;padding:3px;position:absolute;right:10px;color:white;\" >Update DB</button>\r\n          <br>Cache : {{(cache/1000).toFixed(2)}} KB\r\n          <div class=\"loading-bar-container\">\r\n            <div ref=\"loadingBar\" class=\"loading-bar\" :style=\"{ width: progressPercent }\"></div>\r\n          </div>\r\n          </div>\r\n          <div v-else>Loading Getting Database ... </div>\r\n          <p class=\"text-lg m-0 p-0\">Face Recognition :\r\n            <span v-if=\"loading\">Loading ...</span>\r\n            <span v-else class=\"font-semibold\">Ready</span>\r\n            \r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport * as faceapi from \"@vladmandic/face-api\";\r\nvar port;\r\nimport axios from 'axios';\r\nvar intervals;\r\nexport default {\r\n  data() {\r\n    return {\r\n      img:null,\r\n      recognition:false,\r\n      loading:true,\r\n      cache:0,\r\n      dbFace:null,\r\n      value: 0,\r\n      max: 8200000,\r\n      dbTime:''\r\n    };\r\n  },\r\n  methods: {\r\n    test(){\r\n        port.postMessage('test');\r\n    },  \r\n    getCache(){\r\n      let that=this;\r\n      intervals = setInterval(() => {\r\n        that.cache=0;\r\n        caches.keys().then(function(cacheNames) {\r\n          if(cacheNames.length>0){\r\n            caches.open(cacheNames[0]).then(function(cache) {\r\n              return cache.keys().then(function(keys) {\r\n                keys.forEach(function(request) {\r\n                  cache.match(request).then(function(response) {\r\n                    response.blob().then(function(blob) {\r\n                      that.cache+=blob.size;\r\n                    });\r\n                  });\r\n                });\r\n              });\r\n            });\r\n          }\r\n        });\r\n      }, 1000);\r\n    },\r\n    async saveDatabase(){\r\n      this.dbFace=false;\r\n      this.dbTime=false;\r\n      let data = await axios.get('https://hitfaceapi.my.id/contact');\r\n      let datas=data.data.datas\r\n      localStorage.setItem('db-face',JSON.stringify(datas));\r\n      localStorage.setItem('db-time',new Date());\r\n      this.loadDatabase();\r\n    },\r\n    loadDatabase(){\r\n      if(localStorage.getItem('db-face')){\r\n        this.dbFace=localStorage.getItem('db-face');\r\n      }\r\n      if(localStorage.getItem('db-time')){\r\n        this.dbTime=localStorage.getItem('db-time');\r\n        console.log(this.dbTime)\r\n      }\r\n      this.$forceUpdate();\r\n    },\r\n    async startScan(videoEl) {\r\n      let that = this;\r\n      that.recognition=false;\r\n      var maxDescriptorDistance = 0.6;\r\n      // var img = document.getElementById(\"image1\");\r\n      var img = new Image();\r\n      img.src=this.img;\r\n      // videoEl = video;\r\n      // var canvas = faceapi.createCanvasFromMedia(video);\r\n      // canvas.style.position = \"absolute;\";\r\n        // taruh base64 ke canvas\r\n        // const img = await canvas.loadImage(this.img);\r\n        // mendapatkan descriptor dari canvas\r\n        // let descriptorImg = await faceapi.detectSingleFace(img).withFaceLandmarks().withFaceDescriptor();\r\n        let descriptorImg = await faceapi.detectSingleFace(img,new faceapi.TinyFaceDetectorOptions({ inputSize: 320 })).withFaceLandmarks(true).withFaceDescriptor()\r\n\r\n        let tensor;\r\n        let wajah;\r\n        if (!descriptorImg) {\r\n            wajah = false;\r\n        } else {\r\n            const regionsToExtract = [\r\n                new faceapi.Rect(descriptorImg.detection.box.x, descriptorImg.detection.box.y, descriptorImg.detection.box.width, descriptorImg.detection.box.height)\r\n            ]\r\n            let faceImages = await faceapi.extractFaces(img, regionsToExtract)\r\n            if (faceImages.length == 0) {\r\n                wajah = false;\r\n            } else {\r\n                faceImages.forEach(cnv => {\r\n                    wajah = cnv.toDataURL();\r\n                })\r\n            }\r\n            // mengconvert data face descriptor ke type Float32Array\r\n            tensor = [\r\n                new Float32Array(descriptorImg.descriptor)\r\n            ]\r\n        }\r\n\r\n        if (wajah) {\r\n            let datas = JSON.parse(localStorage.getItem('db-face'));\r\n            // let data = await axios.get('./data-wajah.json');\r\n            // let datas=data.data\r\n            // let datas = await readJsonWajah();\r\n            // console.log(datas)\r\n            if (datas.length > 0) {\r\n                // CEK DUPLICATE\r\n                const labeledFaceDescriptors = await Promise.all(\r\n                    datas.map(async label => {\r\n                        let faces = JSON.parse(label.tensor)\r\n                        if (faces) {\r\n                            if (faces.length > 0) {\r\n                                const faceDescriptors = []\r\n                                faces.forEach(e => {\r\n                                    // console.log(Object.values(e))\r\n                                    faceDescriptors.push(new Float32Array(Object.values(e))) // multiple tensor data\r\n                                })\r\n                                // console.log(faceDescriptors)\r\n                                return new faceapi.LabeledFaceDescriptors(JSON.stringify({\r\n                                    id_user: label.id_user\r\n                                }), faceDescriptors)\r\n                            }\r\n                        }\r\n                    })\r\n                )\r\n                \r\n                const faceMatcher = new faceapi.FaceMatcher(labeledFaceDescriptors, maxDescriptorDistance)\r\n                if (descriptorImg) {\r\n                    const results = faceMatcher.findBestMatch(descriptorImg.descriptor)\r\n                    if (results._label == \"unknown\") {\r\n                        if (tensor[0]) {\r\n                            that.recognition=false;\r\n                            port.postMessage(JSON.stringify({\r\n                                message: \"wajah tidak dikenali\",\r\n                                status: false,\r\n                                confidence: 100 - (results._distance * 100)\r\n                            }));\r\n                            return;\r\n                        }\r\n                    } else {\r\n                        let user = JSON.parse(results.label);\r\n                        that.recognition=false;\r\n                        port.postMessage(JSON.stringify({\r\n                            message: \"Wajah Mirip dengan id user = \" + user.id_user,\r\n                            status: true,\r\n                            duplicate:true,\r\n                            confidence: 100 - (results._distance * 100),\r\n                            id_user: user.id_user\r\n                        }));\r\n                        console.log(JSON.stringify({\r\n                            // tensor: tensor,\r\n                            // wajah: wajah,\r\n                            message: \"Wajah Mirip dengan id user = \" + user.id_user,\r\n                            status: true,\r\n                            duplicate:true,\r\n                            confidence: 100 - (results._distance * 100),\r\n                            id_user: user.id_user\r\n                        }));\r\n                        return;\r\n                    }\r\n                }\r\n            } else {\r\n                port.postMessage('false');\r\n                that.recognition=false;\r\n                port.postMessage(JSON.stringify({\r\n                    message: 'Tidak ada wajah di Database ',\r\n                    status: false\r\n                }));\r\n                return;\r\n            }\r\n        } else {\r\n            that.recognition=false;\r\n            port.postMessage('false');\r\n            port.postMessage(JSON.stringify({\r\n                message: 'Wajah tidak ditemukan',\r\n                status: false\r\n            }));\r\n            return;\r\n        }\r\n    },\r\n    async loadModel() {\r\n      var MODEL_URL = \"./model\";\r\n      try{\r\n        await faceapi.loadTinyFaceDetectorModel(MODEL_URL);\r\n        await faceapi.loadFaceRecognitionModel(MODEL_URL);\r\n        await faceapi.loadFaceLandmarkTinyModel(MODEL_URL);\r\n        //   await faceapi.loadFaceExpressionModel(MODEL_URL);\r\n        port.postMessage('loading');\r\n        this.loading=false;\r\n      }\r\n      catch(err){\r\n        alert('Gagal load Model face recognition');\r\n        this.loading=false;\r\n      }\r\n       console.log(\"loading model berhasil ...\");\r\n      setTimeout(() => {\r\n        clearInterval(intervals);\r\n      }, 3000);\r\n    },\r\n  },\r\n  computed:{\r\n    progressPercent() {\r\n      return `${Math.floor((this.cache / this.max) * 100)}%`;\r\n    }\r\n  },\r\n  watch: {\r\n    cache(newValue) {\r\n      if (newValue >= this.max) {\r\n        // Once the value reaches the max, set the progress to 100%\r\n        this.$nextTick(() => {\r\n          this.$refs.loadingBar.style.width = '100%';\r\n        });\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    let that=this\r\n    if(!localStorage.getItem('db-face')){\r\n      this.saveDatabase();\r\n    }\r\n    this.loadDatabase();\r\n     window.addEventListener('message', function(event) {\r\n        if (event.data == 'capturePort') {\r\n            // capture port2 coming from the Dart side\r\n            if (event.ports[0] != null) {\r\n                // the port is ready for communication,\r\n                // so you can use port.postMessage(message); wherever you want\r\n                port = event.ports[0];\r\n                // To listen to messages coming from the Dart side, set the onmessage event listener\r\n                port.onmessage = function (event) {\r\n                    // event.data contains the message data coming from the Dart side\r\n                    console.log(event.data);\r\n                    that.img=event.data;\r\n                    that.startScan();\r\n                };\r\n            }\r\n        }\r\n    }, false);\r\n    this.getCache();\r\n    this.loadModel();\r\n  },\r\n};\r\n</script>\r\n<style>\r\nbody{\r\n  margin:0;\r\n  padding:0;\r\n}\r\n.loading-bar-container {\r\n  width: 95%;\r\n  height: 10px;\r\n  background-color: #eee;\r\n}\r\n\r\n.loading-bar {\r\n  height: 100%;\r\n  background-color: #EEEA00;\r\n  transition: width 0.3s ease-in-out;\r\n}\r\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=81829cc0&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}